#!/usr/bin/env python3

from helpers.validator import validate_venv
validate_venv()

import sys, argparse

from definitions import NEGATIVE_QUERIES
from scraper.scrape_news import scrape_news_pages
from nlp.nlp import NLProcessor

if __name__ == "__main__":
    parser = argparse.ArgumentParser(prog="scraper")
    parser.add_argument("-n", "--narticles", type=int, action="store", default=10)
    args = parser.parse_args()
    if args.narticles <= 0:
        print("Sorry, values <= 0 are not valid numbers for articles to be scraped\nExiting")
        sys.exit(1)
    if len(NEGATIVE_QUERIES) == 0:
        print("No negative queries have been supplied in .env\nExiting")
        sys.exit(1)
    from database.mock_database import DatabaseNegative

    def process_page(page_processor, url, query):
        if url in DatabaseNegative.get_sources(): return
        summary = "".join(NLProcessor.summarize(page_processor.get_fulltext()))
        DatabaseNegative.insert(query, summary, url)
    scrape_news_pages(NEGATIVE_QUERIES, args.narticles, process_page)
    print("DONE")

